(()=>{var t={453:(t,e,s)=>{const i=s(95);function r(){this.map=(new THREE.TextureLoader).load("assets/images/"+i.meta.image)}r.prototype={getUVConverters:function(t){return t?(t=t.replace("brushes/",""),{convertU:function(e){var s=i.meta.size,r=i.frames[t];return(e>1||e<0)&&(e=0),r.frame.x/s.w+e*r.frame.w/s.w},convertV:function(e){var s=i.meta.size,r=i.frames[t];return(e>1||e<0)&&(e=0),1-(r.frame.y/s.h+e*r.frame.h/s.h)}}):{convertU:function(t){return t},convertV:function(t){return t}}}},window.atlas=new r},967:()=>{window.BinaryManager=function(t){this.dataview=new DataView(t),this.offset=0,this.isLittleEndian=!0},window.BinaryManager.prototype={readQuaternion:function(){return new THREE.Quaternion(this.readFloat(),this.readFloat(),this.readFloat(),this.readFloat())},readVector3:function(){return new THREE.Vector3(this.readFloat(),this.readFloat(),this.readFloat())},readString:function(){for(var t=this.dataview.getUint8(this.offset++,!0),e="",s=0;s<t;s++)e+=String.fromCharCode(this.dataview.getUint8(this.offset++,!0));return e},readColor:function(){return new THREE.Color(this.readFloat(),this.readFloat(),this.readFloat())},readFloat:function(){var t=this.dataview.getFloat32(this.offset,!0);return this.offset+=4,t},readUint32:function(){var t=this.dataview.getUint32(this.offset,!0);return this.offset+=4,t},readUint16:function(){var t=this.dataview.getUint16(this.offset,!0);return this.offset+=2,t},readUint8:function(){var t=this.dataview.getUint8(this.offset,!0);return this.offset++,t},writeVector:function(t){this.writeFloat32Array(t.toArray())},writeColor:function(t){this.writeFloat32Array(t.toArray())},writeString:function(t){this.writeUint8(t.length);for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))},writeUint8:function(t){this.dataview.setUint8(this.offset,t,this.isLittleEndian),this.offset++},writeUint16:function(t){this.dataview.setUint16(this.offset,t,this.isLittleEndian),this.offset+=2},writeUint32:function(t){this.dataview.setUint32(this.offset,t,this.isLittleEndian),this.offset+=4},writeFloat32:function(t){this.dataview.setFloat32(this.offset,t,this.isLittleEndian),this.offset+=4},writeFloat32Array:function(t){for(var e=0;e<t.length;e++)this.writeFloat32(t[e])},getDataView:function(){return this.dataview}}},830:()=>{AFRAME.registerBrush("cubes",{init:function(t,e){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.5,metalness:.5,side:THREE.DoubleSide,flatShading:!0}),this.geometry=new THREE.BoxGeometry(1,1,1),this.drawingEl=document.querySelector(".a-drawing"),this.drawingEl.object3D.add(this.object3D)},addPoint:function(t,e,s,i,r){var a=new THREE.Mesh(this.geometry,this.material),n=i*this.data.size*Math.random();return a.scale.set(n,n,n),a.position.copy(s),a.quaternion.copy(e),this.object3D.add(a),!0},undo:function(){this.drawingEl.object3D.children.pop()}},{thumbnail:"brushes/thumb_cubes.gif",spacing:.01})},295:(t,e,s)=>{var i=s(297),r=s(51);!function(){r((function(){var t={vertexColors:!0,side:THREE.DoubleSide},e={roughness:.75,metalness:.25,vertexColors:!0,map:window.atlas.map,side:THREE.DoubleSide},s={roughness:.75,metalness:.25,vertexColors:!0,side:THREE.DoubleSide,map:window.atlas.map,transparent:!0,alphaTest:.5};i.addSharedBuffer("strip-flat",new THREE.MeshBasicMaterial(t)),i.addSharedBuffer("strip-shaded",new THREE.MeshStandardMaterial(e)),i.addSharedBuffer("strip-textured",new THREE.MeshStandardMaterial(s))}));for(var t,e,s,a,n,o,h={init:function(t,e){this.sharedBuffer=i.getSharedBuffer("strip-"+this.materialOptions.type),this.sharedBuffer.restartPrimitive(),this.sharedBuffer.strip=!0,this.prevIdx=Object.assign({},this.sharedBuffer.idx),this.idx=Object.assign({},this.sharedBuffer.idx),this.first=!0},remove:function(){this.sharedBuffer.remove(this.prevIdx,this.idx)},undo:function(){this.sharedBuffer.undo(this.prevIdx)},addPoint:(o=new THREE.Vector3,function(t,e,s,i,r){var a=this.materialOptions.converter;o.set(1,0,0),o.applyQuaternion(e),o.normalize();var n=s.clone(),h=s.clone(),u=this.data.size*i;if(n.add(o.clone().multiplyScalar(u/2)),h.add(o.clone().multiplyScalar(-u/2)),this.first&&this.prevIdx.position>0&&(this.first=!1,this.sharedBuffer.addVertex(n.x,n.y,n.z),this.sharedBuffer.idx.normal++,this.sharedBuffer.idx.color++,this.sharedBuffer.idx.uv++,this.idx=Object.assign({},this.sharedBuffer.idx)),this.sharedBuffer.addVertex(n.x,n.y,n.z),this.sharedBuffer.addVertex(h.x,h.y,h.z),this.sharedBuffer.idx.normal+=2,this.sharedBuffer.addColor(this.data.color.r,this.data.color.g,this.data.color.b),this.sharedBuffer.addColor(this.data.color.r,this.data.color.g,this.data.color.b),"textured"===this.materialOptions.type){this.sharedBuffer.idx.uv+=2;for(var d,l,c=this.sharedBuffer.current.attributes.uv.array,m=0;m<this.data.numPoints+1;m++)d=m/this.data.numPoints,l=4*m,0!==this.prevIdx.uv&&(l+=2*(this.prevIdx.uv+1)),c[l]=a.convertU(d),c[l+1]=a.convertV(0),c[l+2]=a.convertU(d),c[l+3]=a.convertV(1)}return this.idx=Object.assign({},this.sharedBuffer.idx),this.sharedBuffer.update(),this.computeVertexNormals(),!0}),computeVertexNormals:(t=new THREE.Vector3,e=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3,n=new THREE.Vector3,function(){for(var i=0===this.prevIdx.position?0:3*(this.prevIdx.position+1),r=3*this.idx.position,o=this.sharedBuffer.current.attributes.position.array,h=this.sharedBuffer.current.attributes.normal.array,u=i;u<=r;u++)h[u]=0;var d=!0;for(u=i;u<r-6;u+=3)d?(t.fromArray(o,u),e.fromArray(o,u+3),s.fromArray(o,u+6)):(e.fromArray(o,u),s.fromArray(o,u+6),t.fromArray(o,u+3)),d=!d,a.subVectors(s,e),n.subVectors(t,e),a.cross(n),a.normalize(),h[u]+=a.x,h[u+1]+=a.y,h[u+2]+=a.z,h[u+3]+=a.x,h[u+4]+=a.y,h[u+5]+=a.z,h[u+6]+=a.x,h[u+7]+=a.y,h[u+8]+=a.z;for(u=i+6;u<r-6;u++)h[u]=h[u]/3;h[i+3]=h[i+3]/2,h[i+3+1]=h[i+3+1]/2,h[i+3+2]=h[i+3+2]/2,h[r-6]=h[r-6]/2,h[r-6+1]=h[r-6+1]/2,h[r-6+2]=h[r-6+2]/2})},u=[{name:"flat",materialOptions:{type:"flat"},thumbnail:"brushes/thumb_flat.gif"},{name:"smooth",materialOptions:{type:"shaded"},thumbnail:"brushes/thumb_smooth.gif"},{name:"squared-textured",materialOptions:{type:"textured",textureSrc:"brushes/squared_textured.png"},thumbnail:"brushes/thumb_squared_textured.gif"},{name:"line-gradient",materialOptions:{type:"textured",textureSrc:"brushes/line_gradient.png"},thumbnail:"brushes/thumb_line_gradient.gif"},{name:"silky-flat",materialOptions:{type:"textured",textureSrc:"brushes/silky_flat.png"},thumbnail:"brushes/thumb_silky_flat.gif"},{name:"silky-textured",materialOptions:{type:"textured",textureSrc:"brushes/silky_textured.png"},thumbnail:"brushes/thumb_silky_textured.gif"},{name:"lines1",materialOptions:{type:"textured",textureSrc:"brushes/lines1.png"},thumbnail:"brushes/thumb_lines1.gif"},{name:"lines2",materialOptions:{type:"textured",textureSrc:"brushes/lines2.png"},thumbnail:"brushes/thumb_lines2.gif"},{name:"lines3",materialOptions:{type:"textured",textureSrc:"brushes/lines3.png"},thumbnail:"brushes/thumb_lines3.gif"},{name:"lines4",materialOptions:{type:"textured",textureSrc:"brushes/lines4.png"},thumbnail:"brushes/thumb_lines4.gif"},{name:"lines5",materialOptions:{type:"textured",textureSrc:"brushes/lines5.png"},thumbnail:"brushes/thumb_lines5.gif"},{name:"line-grunge1",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge1.png"},thumbnail:"brushes/thumb_line_grunge1.gif"},{name:"line-grunge2",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge2.png"},thumbnail:"brushes/thumb_line_grunge2.gif"},{name:"line-grunge3",materialOptions:{type:"textured",textureSrc:"brushes/line_grunge3.png"},thumbnail:"brushes/thumb_line_grunge3.gif"}],d=0;d<u.length;d++){var l=u[d];l.materialOptions.textureSrc?l.materialOptions.converter=window.atlas.getUVConverters(l.materialOptions.textureSrc):l.materialOptions.converter=window.atlas.getUVConverters(null),AFRAME.registerBrush(l.name,Object.assign({},h,{materialOptions:l.materialOptions}),{thumbnail:l.thumbnail,maxPoints:3e3})}}()},775:()=>{var t,e,s,r,a;a=new THREE.ShaderMaterial({vertexShader:"varying vec2 vUv;     void main() {       vUv = uv;       gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );     }",fragmentShader:"uniform sampler2D tDiffuse;     uniform float amount;     uniform float time;     varying vec2 vUv;         vec3 hsv2rgb(vec3 c) {         vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);         vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);         return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);     }         void main() {       float h = mod(vUv.x - time / 3000.0, 1.0);       vec4 color = vec4(hsv2rgb(vec3(h, 1.0, 0.5)), 1.0);       gl_FragColor = color;     }",side:THREE.DoubleSide,uniforms:{time:{type:"f",value:0}}}),AFRAME.registerBrush("line-rainbow",{init:function(t,e){this.idx=0,this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(3*this.options.maxPoints*3),this.indices=new Uint32Array(4.5*this.options.maxPoints*4.5),this.uvs=new Float32Array(2*this.options.maxPoints*2),this.linepositions=new Float32Array(this.options.maxPoints),this.geometry.setDrawRange(0,0),this.geometry.setAttribute("position",new THREE.BufferAttribute(this.vertices,3).setUsage(THREE.DynamicDrawUsage)),this.geometry.setIndex(new THREE.BufferAttribute(this.indices,3).setUsage(THREE.DynamicDrawUsage)),this.geometry.setAttribute("uv",new THREE.BufferAttribute(this.uvs,2).setUsage(THREE.DynamicDrawUsage)),this.geometry.setAttribute("lineposition",new THREE.BufferAttribute(this.linepositions,1).setUsage(THREE.DynamicDrawUsage)),this.material=a;var s=new THREE.Mesh(this.geometry,this.material);s.frustumCulled=!1,s.vertices=this.vertices,this.object3D.add(s),this.drawing=document.querySelector(".a-drawing"),this.drawing.object3D.add(this.object3D)},addPoint:(t=new THREE.Vector3,e=new THREE.Vector3,s=new THREE.Vector3,r=new THREE.Vector3,function(a,n,o,h,u){var d=0;for(i=0;i<this.data.numPoints;i++)this.uvs[d++]=i/(this.data.numPoints-1),this.uvs[d++]=0,this.uvs[d++]=i/(this.data.numPoints-1),this.uvs[d++]=1;t.set(1,0,0),t.applyQuaternion(n),t.normalize(),e.copy(o),s.copy(o);var l=this.data.size*h;return e.add(r.copy(t).multiplyScalar(l/2)),s.add(r.copy(t).multiplyScalar(-l/2)),this.vertices[this.idx++]=e.x,this.vertices[this.idx++]=e.y,this.vertices[this.idx++]=e.z,this.vertices[this.idx++]=s.x,this.vertices[this.idx++]=s.y,this.vertices[this.idx++]=s.z,this.idx>6&&(this.geometry.index.setXYZ(this.idx/3-4,this.idx/3-4,this.idx/3-3,this.idx/3-2),this.geometry.index.setXYZ(this.idx/3-3,this.idx/3-2,this.idx/3-3,this.idx/3-1)),this.geometry.attributes.position.needsUpdate=!0,this.geometry.index.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0,this.geometry.setDrawRange(0,2*this.data.numPoints*6),!0}),tick:function(t,e){this.material.uniforms.time.value=t},undo:function(){this.drawing.object3D.children.pop()}},{thumbnail:"brushes/thumb_rainbow.png",maxPoints:3e3})},891:()=>{AFRAME.registerBrush("single-sphere",{init:function(t,e){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.6,metalness:.2,side:THREE.FrontSide,flatShading:!0}),this.geometry=new THREE.IcosahedronGeometry(1,2),this.mesh=new THREE.Mesh(this.geometry,this.material),this.object3D.add(this.mesh),this.mesh.visible=!1,this.drawingEl=document.querySelector(".a-drawing"),this.drawingEl.object3D.add(this.object3D)},addPoint:function(t,e,s,i,r){this.firstPoint||(this.firstPoint=s.clone(),this.mesh.position.set(this.firstPoint.x,this.firstPoint.y,this.firstPoint.z)),this.mesh.visible=!0;var a=this.firstPoint.distanceTo(s);return this.mesh.scale.set(a,a,a),!0},undo:function(){this.drawingEl.object3D.children.pop()}},{thumbnail:"brushes/thumb_single_sphere.png",spacing:0})},988:()=>{AFRAME.registerBrush("spheres",{init:function(t,e){this.material=new THREE.MeshStandardMaterial({color:this.data.color,roughness:.5,metalness:.5,side:THREE.DoubleSide,flatShading:!0}),this.geometry=new THREE.IcosahedronGeometry(1,0),this.drawingEl=document.querySelector(".a-drawing"),this.drawingEl.object3D.add(this.object3D)},addPoint:function(t,e,s,i,r){var a=new THREE.Mesh(this.geometry,this.material),n=this.data.size/2*i;return a.scale.set(n,n,n),a.initialScale=a.scale.clone(),a.phase=Math.random()*Math.PI*2,a.position.copy(s),a.quaternion.copy(e),this.object3D.add(a),!0},tick:function(t,e){for(var s=0;s<this.object3D.children.length;s++){var i=this.object3D.children[s],r=(Math.sin(i.phase+t/500)+1)/2+.1;i.scale.copy(i.initialScale).multiplyScalar(r)}},undo:function(){this.drawingEl.object3D.children.pop()}},{thumbnail:"brushes/thumb_spheres.gif",spacing:.01})},623:(t,e,s)=>{var i=s(297),r=s(51);!function(){r((function(){var t=new THREE.MeshStandardMaterial({side:THREE.DoubleSide,map:window.atlas.map,vertexColors:!0,transparent:!0,alphaTest:.5,roughness:.75,metalness:.25}),e=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:window.atlas.map,vertexColors:!0,transparent:!0,alphaTest:.5});i.addSharedBuffer("tris-flat",e),i.addSharedBuffer("tris-shaded",t)}));for(var t,e,s,a,n,o,h,u,d={init:function(t,e){this.sharedBuffer=i.getSharedBuffer("tris-"+this.materialOptions.type),this.prevIdx=Object.assign({},this.sharedBuffer.idx),this.idx=Object.assign({},this.sharedBuffer.idx),this.sharedBuffer.strip=!1,this.currAngle=0,this.subTextures=1,this.angleJitter=0,this.autoRotate=!1,void 0!==this.materialOptions.subTextures&&(this.subTextures=this.materialOptions.subTextures),!0===this.materialOptions.autoRotate&&(this.autoRotate=!0),void 0!==this.materialOptions.angleJitter&&(this.angleJitter=this.materialOptions.angleJitter,this.angleJitter=2*this.angleJitter-this.angleJitter)},remove:function(){this.sharedBuffer.remove(this.prevIdx,this.idx)},undo:function(){this.sharedBuffer.undo(this.prevIdx)},addPoint:(t=new THREE.Vector3,e=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,h=new THREE.Vector3,u=Math.PI/2,function(i,r,d,l,c){e.set(1,0,0),e.applyQuaternion(r),e.normalize(),t.set(0,1,0),t.applyQuaternion(r),t.normalize();var m=this.data.size*l/2,p=Math.PI/4+Math.random()*this.angleJitter;this.autoRotate&&(this.currAngle+=.1,p+=this.currAngle),s.copy(d).add(h.copy(e.applyAxisAngle(t,p)).multiplyScalar(m)),a.copy(d).add(h.copy(e.applyAxisAngle(t,u)).multiplyScalar(m)),n.copy(d).add(h.copy(e.applyAxisAngle(t,u)).multiplyScalar(m)),o.copy(d).add(e.applyAxisAngle(t,u).multiplyScalar(m)),this.idx.position,this.idx.position,this.sharedBuffer.addVertex(s.x,s.y,s.z),this.sharedBuffer.addVertex(a.x,a.y,a.z),this.sharedBuffer.addVertex(n.x,n.y,n.z),this.sharedBuffer.addVertex(n.x,n.y,n.z),this.sharedBuffer.addVertex(o.x,o.y,o.z),this.sharedBuffer.addVertex(s.x,s.y,s.z);for(var f=0;f<6;f++)this.sharedBuffer.addNormal(t.x,t.y,t.z),this.sharedBuffer.addColor(this.data.color.r,this.data.color.g,this.data.color.b);this.data.numPoints;var g=0,b=1;if(this.subTextures>1){var v=Math.floor(Math.random()*this.subTextures);b=(g=1/this.subTextures*v)+1/this.subTextures}var y=this.materialOptions.converter;return this.sharedBuffer.addUV(y.convertU(g),y.convertV(1)),this.sharedBuffer.addUV(y.convertU(g),y.convertV(0)),this.sharedBuffer.addUV(y.convertU(b),y.convertV(0)),this.sharedBuffer.addUV(y.convertU(b),y.convertV(0)),this.sharedBuffer.addUV(y.convertU(b),y.convertV(1)),this.sharedBuffer.addUV(y.convertU(g),y.convertV(1)),this.idx=Object.assign({},this.sharedBuffer.idx),this.sharedBuffer.update(),!0})},l=[{name:"dots",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_dots.png"},thumbnail:"brushes/thumb_stamp_dots.gif",spacing:.01},{name:"squares",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_squares.png"},thumbnail:"brushes/thumb_stamp_squares.gif",spacing:.01},{name:"column",materialOptions:{type:"shaded",autoRotate:!0,textureSrc:"brushes/stamp_column.png"},thumbnail:"brushes/thumb_stamp_column.gif",spacing:.01},{name:"gear1",materialOptions:{type:"shaded",angleJitter:2*Math.PI,subTextures:2,textureSrc:"brushes/stamp_gear.png"},thumbnail:"brushes/thumb_stamp_gear.gif",spacing:.05},{name:"grunge1",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge1.png"},thumbnail:"brushes/stamp_grunge1.png",spacing:.02},{name:"grunge2",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge2.png"},thumbnail:"brushes/stamp_grunge2.png",spacing:.02},{name:"grunge3",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge3.png"},thumbnail:"brushes/stamp_grunge3.png",spacing:.02},{name:"grunge4",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge4.png"},thumbnail:"brushes/stamp_grunge4.png",spacing:.02},{name:"grunge5",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_grunge5.png"},thumbnail:"brushes/thumb_stamp_grunge5.gif",spacing:.02},{name:"leaf1",materialOptions:{type:"shaded",angleJitter:Math.PI,textureSrc:"brushes/stamp_leaf1.png"},thumbnail:"brushes/stamp_leaf1.png",spacing:.03},{name:"leaf2",materialOptions:{type:"shaded",angleJitter:60*Math.PI/180,textureSrc:"brushes/stamp_leaf2.png"},thumbnail:"brushes/thumb_stamp_leaf2.gif",spacing:.03},{name:"leaf3",materialOptions:{type:"shaded",angleJitter:60*Math.PI/180,textureSrc:"brushes/stamp_leaf3.png"},thumbnail:"brushes/thumb_stamp_leaf3.gif",spacing:.03},{name:"fur1",materialOptions:{type:"shaded",angleJitter:40*Math.PI/180,subTextures:2,textureSrc:"brushes/stamp_fur1.png"},thumbnail:"brushes/stamp_fur1.png",spacing:.01},{name:"fur2",materialOptions:{type:"shaded",angleJitter:10*Math.PI/180,subTextures:3,textureSrc:"brushes/stamp_fur2.png"},thumbnail:"brushes/stamp_fur2.png",spacing:.01},{name:"grass",materialOptions:{type:"shaded",angleJitter:10*Math.PI/180,subTextures:3,textureSrc:"brushes/stamp_grass.png"},thumbnail:"brushes/thumb_stamp_grass.png",spacing:.03},{name:"bush",materialOptions:{type:"shaded",subTextures:2,textureSrc:"brushes/stamp_bush.png"},thumbnail:"brushes/thumb_stamp_bush.gif",spacing:.04},{name:"star",materialOptions:{type:"shaded",textureSrc:"brushes/stamp_star.png"},thumbnail:"brushes/thumb_stamp_star.png",spacing:.06},{name:"snow",materialOptions:{type:"shaded",angleJitter:2*Math.PI,textureSrc:"brushes/stamp_snow.png"},thumbnail:"brushes/thumb_stamp_snow.png",spacing:.06}],c=0;c<l.length;c++){var m=l[c];m.materialOptions.textureSrc&&(m.materialOptions.map=window.atlas.map,m.materialOptions.converter=window.atlas.getUVConverters(m.materialOptions.textureSrc),delete m.materialOptions.textureSrc),AFRAME.registerBrush(m.name,Object.assign({},d,{materialOptions:m.materialOptions}),{thumbnail:m.thumbnail,spacing:m.spacing,maxPoints:3e3})}}()},142:()=>{AFRAME.registerComponent("brush-tip",{schema:{controller:{type:"string"},hand:{type:"string",oneOf:["left","right"]},model:{type:"string",default:"#tipObj"}},init:function(){var t=t=>THREE.MathUtils.degToRad(t);this.controllers={default:{left:{positionOffset:{x:0,y:-.025,z:-.042},rotationOffset:{x:t(-45),y:t(7),z:t(-7)}},right:{positionOffset:{x:0,y:-.025,z:-.042},rotationOffset:{x:t(-45),y:t(-7),z:t(7)}}}},this.data.controller&&this.setController(this.data.controller,this.data.hand),this.el.setAttribute("gltf-model",this.data.model)},setController:function(t,e){this.controllers[t]||(t="default"),this.el.object3D.position.set(this.controllers[t][e].positionOffset.x,this.controllers[t][e].positionOffset.y,this.controllers[t][e].positionOffset.z),this.el.object3D.rotation.set(this.controllers[t][e].rotationOffset.x,this.controllers[t][e].rotationOffset.y,this.controllers[t][e].rotationOffset.z)}})},620:()=>{var t,e,s;AFRAME.registerComponent("brush",{schema:{hand:{type:"string",oneOf:["left","right",""],default:""},color:{type:"color",default:"#ef2d5e"},size:{default:.01,min:.001,max:.3},sizeModifier:{type:"number",default:0},brush:{default:"smooth"},owner:{type:"string",default:"local"},enabled:{type:"boolean",default:!0},undo:{type:"int",default:0}},init:function(){var t=this.data;this.color=new THREE.Color(t.color),this.el.emit("brushcolor-changed",{color:this.color}),this.el.emit("brushsize-changed",{brushSize:t.size}),this.obj=this.el.object3D,this.currentStroke=null,this.strokeEntities=[],this.textures={},this.currentMap=0,this.model=this.el.getObject3D("mesh"),this.drawing=!1,this.onUndo=this.onUndo.bind(this),this.onPaint=this.onPaint.bind(this),this.el.addEventListener("undo",this.onUndo),this.el.addEventListener("paint",this.onPaint),""===this.data.hand?this.hand=this.el.id.endsWith("right-hand")?"right":"left":this.hand=this.data.hand},update:function(t){for(var e=this.data;this.data.undo>0;)this.undo(),this.data.undo--;t.sizeModifier!==this.data.sizeModifier&&this.paint(),t.color!==e.color&&(this.color.set(e.color),this.el.emit("brushcolor-changed",{color:this.color})),t.size!==e.size&&this.el.emit("brushsize-changed",{size:e.size})},tick:(t=new THREE.Vector3,e=new THREE.Quaternion,s=new THREE.Vector3,function(i,r){if(this.currentStroke&&this.active){this.obj.matrixWorld.decompose(t,e,s);var a=this.system.getPointerPosition(t,e,this.hand);this.currentStroke.addPoint(t,e,a,this.sizeModifier,i)}}),remove:function(){this.clear()},startNewStroke:function(){this.el.components.ui?.playSound("ui_paint"),this.currentStroke=this.system.addNewStroke(this.data.brush,this.color,this.data.size,this.data.owner),this.el.emit("stroke-started",{entity:this.el,stroke:this.currentStroke})},paint:function(){this.sizeModifier=this.data.enabled?this.data.sizeModifier:0,this.sizeModifier>.1?this.active||(this.startNewStroke(),this.active=!0):this.active&&(this.previousEntity=this.currentEntity,this.currentStroke=null,this.active=!1)},undo:function(){this.system.undo(this.data.owner)},clear:function(){this.system.clear(this.data.owner)},onUndo:function(t){this.data.enabled&&(this.undo(),this.el.components.ui?.playSound("ui_undo"))},onPaint:function(t){this.data.sizeModifier=t.detail.value,this.paint()}})},510:()=>{AFRAME.registerComponent("json-model",{schema:{src:{type:"asset"}},init:function(){this.objectLoader=new THREE.ObjectLoader,this.objectLoader.setCrossOrigin("")},update:function(t){var e=this,s=this.data.src;s&&s!==t.src&&this.objectLoader.load(this.data.src,(function(t){var i=(new THREE.Matrix4).makeRotationX(-Math.PI/2);t.traverse((function(t){t instanceof THREE.Mesh&&t.position.applyMatrix4(i)})),e.el.setObject3D("mesh",t),e.el.emit("model-loaded",{format:"json",model:t,src:s})}))}})},788:()=>{AFRAME.registerComponent("logo-model",{schema:{opacity:{default:1}},init:function(){this.model=null,this.el.setAttribute("obj-model","obj: #logoobj; mtl: #logomtl"),this.el.addEventListener("model-loaded",this.setModel.bind(this))},setModel:function(t){this.model=t.detail.model},update:function(){null!=this.model&&(this.model.children[0].material.opacity=this.data.opacity)}})},101:()=>{AFRAME.registerSystem("paint-controls",{numberStrokes:0,tooltipFadeEvent:new Event("tooltip-fade"),tooltipsDisplayed:!1,showTooltips:function(t){if(!this.tooltipsDisplayed){for(const e of Utils.getTooltips(t)){e.setAttribute("visible",!0);for(const t of e.querySelectorAll("[tooltip]"))t.setAttribute("animation",{dur:1e3,delay:2e3,property:"tooltip.opacity",from:1,to:0,startEvents:"tooltip-fade"}),t.addEventListener("animationcomplete",this.hideTooltipLine,{once:!0})}this.tooltipsDisplayed=!0}},hideTooltips:function(){if(this.numberStrokes++,3===this.numberStrokes)for(const t of document.querySelectorAll("[tooltip]"))t.dispatchEvent(this.tooltipFadeEvent)},hideTooltipLine:function(t){const e=t.target.getObject3D("line");e&&(e.visible=!1)}}),AFRAME.registerComponent("paint-controls",{dependencies:["brush"],schema:{hand:{type:"string",oneOf:["left","right"],default:"left"},controller:{type:"string",default:"auto"},tipModel:{type:"string",default:"#tipObj"},tooltips:{type:"boolean",default:!0},hideController:{type:"boolean",default:!1}},init:function(){var t="assets/images/controller-pressed.png";this.controller=null,this.modelLoaded=!1,this.touchStarted=!1,this.startAxis=0,this.numberStrokes=0,this.el.object3D.visible=!1,this.onModelLoaded=this.onModelLoaded.bind(this),this.onChangeBrushSizeAbs=this.onChangeBrushSizeAbs.bind(this),this.onChangeBrushSizeInc=this.onChangeBrushSizeInc.bind(this),this.onStartChangeBrushSize=this.onStartChangeBrushSize.bind(this),this.onControllerconnected=this.onControllerconnected.bind(this),this.onBrushSizeChanged=this.onBrushSizeChanged.bind(this),this.onBrushColorChanged=this.onBrushColorChanged.bind(this),this.onStrokeStarted=this.onStrokeStarted.bind(this),"auto"!==this.data.controller&&this.setController(this.data.controller,this.data.hand),this.el.sceneEl.systems.material.loadTexture(t,{src:t},this.createTexture.bind(this))},createTexture:function(t){var e=this.highLightMaterial=new THREE.MeshBasicMaterial;e.map=t,e.needsUpdate=!0},createBrushTip:function(t,e){this.brushTip=document.createElement("a-entity"),this.brushTip.id=`${e}-tip`,this.brushTip.setAttribute("brush-tip",{hand:e,controller:t,model:this.tipModel}),this.brushTip.addEventListener("model-loaded",this.onModelLoaded),this.el.appendChild(this.brushTip)},changeBrushColor:function(t){this.modelLoaded&&this.buttonMeshes.sizeHint&&(this.buttonMeshes.colorTip.material.color.copy(t),this.buttonMeshes.sizeHint.material.color.copy(t))},changeBrushSize:function(t){var e=t/2*10;this.modelLoaded&&this.buttonMeshes.sizeHint&&this.buttonMeshes.sizeHint.scale.set(e,1,e)},mapping:{axis0:"trackpad",axis1:"trackpad",button0:"trackpad",button1:"trigger",button2:"grip",button3:"menu",button4:"system"},update:function(){const t={hand:this.data.hand,model:!0};this.el.setAttribute("magicleap-controls",t),this.el.setAttribute("vive-controls",t),this.el.setAttribute("oculus-touch-controls",t),this.el.setAttribute("pico-controls",t),this.el.setAttribute("windows-motion-controls",t),this.el.setAttribute("hp-mixed-reality-controls",t)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded),this.el.addEventListener("changeBrushSizeAbs",this.onChangeBrushSizeAbs),this.el.addEventListener("changeBrushSizeInc",this.onChangeBrushSizeInc),this.el.addEventListener("startChangeBrushSize",this.onStartChangeBrushSize),this.el.addEventListener("controllerconnected",this.onControllerconnected),this.el.addEventListener("brushsize-changed",this.onBrushSizeChanged),this.el.addEventListener("brushcolor-changed",this.onBrushColorChanged),document.addEventListener("stroke-started",this.onStrokeStarted)},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded),this.el.removeEventListener("changeBrushSizeAbs",this.onChangeBrushSizeAbs),this.el.removeEventListener("changeBrushSizeInc",this.onChangeBrushSizeInc),this.el.removeEventListener("startChangeBrushSize",this.onStartChangeBrushSize),this.el.removeEventListener("controllerconnected",this.onControllerconnected),this.el.removeEventListener("brushsize-changed",this.onBrushSizeChanged),this.el.removeEventListener("brushcolor-changed",this.onBrushColorChanged),document.removeEventListener("stroke-started",this.onStrokeStarted)},setModelVisibility:function(){const t=this.isPlaying?!this.data.hideController:this.data.hideController;this.controllerModel=this.el.getObject3D("mesh"),this.controllerModel&&(this.controllerModel.visible=t)},setController:function(t,e){this.controller||(this.createBrushTip(t,e),this.data.tooltips&&this.system.showTooltips(t),this.controller=this.data.controller=t,this.el.object3D.visible=!0)},play:function(){this.addEventListeners(),this.isPlaying=!0,this.setModelVisibility(),this.el.components.brush.data.enabled=!0},pause:function(){this.removeEventListeners(),this.isPlaying=!1,this.setModelVisibility(),this.el.components.brush.data.enabled=!1},onModelLoaded:function(t){if(this.controllerModel||this.setModelVisibility(),(t.target===this.el||t.target.id.includes("-tip"))&&!this.buttonMeshes){var e,s=t.detail.model;(e=this.buttonMeshes={}).sizeHint=s.getObjectByName("sizehint"),e.colorTip=s.getObjectByName("tip"),this.modelLoaded=!0,this.changeBrushSize(this.el.components.brush.data.size),this.changeBrushColor(this.el.components.brush.color)}},onChangeBrushSizeAbs:function(t){if(0!==t.detail.axis[1]||0!==t.detail.axis[3]){var e=(t.detail.axis[1]||t.detail.axis[3])/300,s=this.el.components.brush.schema.size,i=THREE.MathUtils.clamp(this.el.getAttribute("brush").size-e,s.min,s.max);this.el.setAttribute("brush","size",i)}},onChangeBrushSizeInc:function(t){if(0!==t.detail.axis[1]||0!==t.detail.axis[3]){var e=t.detail.axis[1]||t.detail.axis[3];this.touchStarted&&(this.touchStarted=!1,this.startAxis=(e+1)/2);var s=(e+1)/2,i=(this.startAxis-s)/2;this.startAxis=s;var r=this.el.getAttribute("brush").size,a=this.el.components.brush.schema.size,n=THREE.MathUtils.clamp(r-i,a.min,a.max);this.el.setAttribute("brush","size",n)}},onStartChangeBrushSize:function(){this.touchStarted=!0},onControllerconnected:function(t){var e=t.detail.name,s=t.detail.component.data.hand;this.setController(e,s)},onBrushSizeChanged:function(t){this.changeBrushSize(t.detail.size)},onBrushColorChanged:function(t){this.changeBrushColor(t.detail.color)},onStrokeStarted:function(t){t.detail.entity.components["paint-controls"]===this&&(this.numberStrokes++,this.data.tooltips&&this.system.hideTooltips())},onButtonEvent:function(t,e){var s=this.mapping["button"+t];this.el.emit(s+e),this.updateModel(s,e)},updateModel:function(t,e){var s="up"===e?this.material:this.highLightMaterial,i=this.buttonMeshes,r=i&&i[t];if("down"===e&&r&&!this.material&&(s=this.material=r.material),s)return"grip"===t?(i.grip.left.material=s,void(i.grip.right.material=s)):void(r&&(r.material=s))}})},688:()=>{var t,e;AFRAME.registerComponent("ui",{schema:{brightness:{default:1,max:1,min:0},opacity:{default:0}},dependencies:["brush"],init:function(){var t=this.el,e=this.uiEl=document.createElement("a-entity");this.closed=!0,this.isTooltipPaused=!1,this.colorStack=["#272727","#727272","#FFFFFF","#24CAFF","#249F90","#F2E646","#EF2D5E"],this.bindMethods(),this.colorHasChanged=!0,this.highlightMaterials={},this.intersectedObjects=[],this.hoveredOffObjects=[],this.hoveredOnObjects=[],this.pressedObjects={},this.selectedObjects={},this.unpressedObjects={},this.brushButtonsMapping={},this.brushRegexp=/^(?!.*(fg|bg)$)brush[0-9]+/,this.colorHistoryRegexp=/^(?!.*(fg|bg)$)colorhistory[0-9]+$/,this.hsv={h:0,s:0,v:1},this.rayDistance=.2,this.cursorOffset=new THREE.Vector3(.06409,.01419,-.10242),e.setAttribute("material",{color:"#ffffff",flatShading:!0,shader:"flat",transparent:!0,fog:!1,src:"#uinormal"}),e.setAttribute("obj-model","obj:#uiobj"),e.setAttribute("position","0 0.04 -0.15"),e.setAttribute("scale","0 0 0"),e.setAttribute("visible",!1),e.classList.add("apainter-ui"),t.appendChild(e),t.setAttribute("raycaster",{far:.2,objects:".apainter-ui",showLine:!0,lineColor:"#74BEC1"}),this.ray=this.el.getObject3D("line"),this.ray.visible=!1,this.controller=null;var s=this;t.addEventListener("controllerconnected",(function(t){var e=t.detail.name;s.tooltips=Utils.getTooltips(e),s.controller={name:e,hand:t.detail.component.data.hand},s.el.isPlaying&&s.addToggleEvent(),s.adjustTooltips()}))},adjustTooltips:function(){const t=new THREE.Box3,e=new THREE.Vector3;return function(){if("oculus-touch-controls"!==this.controller.name)return;const s=this,i=this.el.querySelector(".oculus-tooltips");this.el.addEventListener("model-loaded",(function(r){r.target===s.el&&r.detail.model.traverse((function(s){let r;"a_button_pressed_value"!==s.name&&"x_button_pressed_value"!==s.name||(r=i.querySelector("[data-tooltip=menu]")),"b_button_pressed_value"!==s.name&&"y_button_pressed_value"!==s.name||(r=i.querySelector("[data-tooltip=teleport]")),"xr_standard_thumbstick_pressed_value"===s.name&&(r=i.querySelector("[data-tooltip=brush-size]")),"xr_standard_trigger_pressed_value"===s.name&&(r=i.querySelector("[data-tooltip=paint]")),"xr_standard_squeeze_pressed_value"===s.name&&(r=i.querySelector("[data-tooltip=undo]")),r&&(t.setFromObject(s,!0).getCenter(e),e.add(s.parent.position),r.setAttribute("tooltip",{targetPosition:e}))}))}))}}(),initColorWheel:function(){var t=this.objects.hueWheel,e=new THREE.ShaderMaterial({uniforms:{brightness:{type:"f",value:this.hsv.v}},vertexShader:"      varying vec2 vUv;      void main() {        vUv = uv;        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);        gl_Position = projectionMatrix * mvPosition;      }      ",fragmentShader:"      #define M_PI2 6.28318530718\n       uniform float brightness;      varying vec2 vUv;      vec3 hsb2rgb(in vec3 c){          vec3 rgb = clamp(abs(mod(c.x * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0,                            0.0,                            1.0 );          rgb = rgb * rgb * (3.0 - 2.0 * rgb);          return c.z * mix( vec3(1.0), rgb, c.y);      }            void main() {        vec2 toCenter = vec2(0.5) - vUv;        float angle = atan(toCenter.y, toCenter.x);        float radius = length(toCenter) * 2.0;        vec3 color = hsb2rgb(vec3((angle / M_PI2) + 0.5, radius, brightness));        gl_FragColor = vec4(color, 1.0);      }      "});t.material=e},bindMethods:function(){this.onComponentChanged=this.onComponentChanged.bind(this),this.onTriggerChanged=this.onTriggerChanged.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersected=this.onIntersected.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onIntersectedCleared=this.onIntersectedCleared.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onStrokeStarted=this.onStrokeStarted.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.open=this.open.bind(this),this.close=this.close.bind(this)},tick:function(){!this.closed&&this.handEl&&(this.updateIntersections(),this.handleHover(),this.handlePressedButtons())},update:function(){this.messagesMaterial&&(this.messagesMaterial.opacity=this.data.opacity)},onTriggerChanged:function(t){var e=t.detail.value;this.lastTriggerValue=e,t.detail.value>=.25?this.triggeredPressed=!0:(this.triggeredPressed=!1,this.handleButtonUp())},handleButtonDown:function(t,e){var s=t.name;if(!this.activeWidget||this.activeWidget===s){switch(this.activeWidget=s,!0){case"brightness"===s:this.onBrightnessDown(e);break;case"brushnext"===s:this.pressedObjects[s]||this.nextPage();break;case"brushprev"===s:this.pressedObjects[s]||this.previousPage();break;case"clear"===s:this.pressedObjects[s]||(this.el.components.brush.clear(),this.playSound("ui_click1"));break;case"copy"===s:this.pressedObjects[s]||(this.copyBrush(),this.playSound("ui_click1"));break;case"hue"===s:this.onHueDown(e);break;case"save"===s:this.pressedObjects[s]||(this.el.sceneEl.systems.painter.upload(),this.playSound("ui_click1"));break;case"sizebg"===s:this.onBrushSizeBackgroundDown(e);break;case this.brushRegexp.test(s):this.onBrushDown(s);break;case this.colorHistoryRegexp.test(s):this.onColorHistoryButtonDown(t);break;default:this.activeWidget=void 0}this.pressedObjects[s]=t}},copyBrush:function(){var t=this.el.getAttribute("brush");this.handEl.setAttribute("brush","brush",t.brush),this.handEl.setAttribute("brush","color",t.color),this.handEl.setAttribute("brush","size",t.size),this.colorHasChanged=!0},handleButtonUp:function(){var t=this.pressedObjects,e=this.unpressedObjects;this.activeWidget=void 0;for(const s in t){const i=t[s].name;e[i]=t[i],delete t[i]}},handlePressedButtons:function(){if(this.triggeredPressed)for(const t of this.hoveredOnObjects)this.handleButtonDown(t.object,t.point)},onColorHistoryButtonDown:function(t){var e=t.material.color.getHexString();this.handEl.setAttribute("brush","color","#"+e),this.playSound("ui_click0",t.name)},onBrushDown:function(t){var e=this.brushButtonsMapping[t];e&&(this.selectBrushButton(t),this.handEl.setAttribute("brush","brush",e.toLowerCase()))},selectBrushButton:function(t){var e=this.uiEl.getObject3D("mesh").getObjectByName(t+"bg"),s=this.selectedObjects,i=this.selectedBrush;i&&(this.highlightMaterials[i.name]||this.initHighlightMaterial(e),i.material=this.highlightMaterials[i.name].normal,delete s[i.name]),s[e.name]=e,this.selectedBrush=e,this.playSound("ui_click1",t)},onHueDown:function(t){var e,s=this.objects.hueWheel,i=this.colorWheelSize;s.updateMatrixWorld(),s.worldToLocal(t),this.objects.hueCursor.position.copy(t);var r=((e={r:Math.sqrt(t.x*t.x+t.z*t.z),theta:Math.PI+Math.atan2(-t.z,t.x)}).theta*(180/Math.PI)+180)%360;this.hsv.h=r/360,this.hsv.s=e.r/i,this.updateColor(),this.playSound("ui_click0","hue")},updateColor:function(){var t=this.hsv2rgb(this.hsv),e="rgb("+t.r+", "+t.g+", "+t.b+")";this.handEl.setAttribute("brush","color",e),this.colorHasChanged=!0},hsv2rgb:function(t){var e,s,i,r,a,n,o,h,u=THREE.MathUtils.clamp(t.h,0,1),d=THREE.MathUtils.clamp(t.s,0,1),l=t.v;switch(n=l*(1-d),o=l*(1-(a=6*u-(r=Math.floor(6*u)))*d),h=l*(1-(1-a)*d),r%6){case 0:e=l,s=h,i=n;break;case 1:e=o,s=l,i=n;break;case 2:e=n,s=l,i=h;break;case 3:e=n,s=o,i=l;break;case 4:e=h,s=n,i=l;break;case 5:e=l,s=n,i=o}return{r:Math.round(255*e),g:Math.round(255*s),b:Math.round(255*i)}},rgb2hsv:function(t,e,s){var i,r=Math.max(t,e,s),a=Math.min(t,e,s),n=r-a,o=0===r?0:n/r,h=r;switch(1===arguments.length&&(e=t.g,s=t.b,t=t.r),r){case a:i=0;break;case t:i=e-s+n*(e<s?6:0),i/=6*n;break;case e:i=s-t+2*n,i/=6*n;break;case s:i=t-e+4*n,i/=6*n}return{h:i,s:o,v:h}},onBrightnessDown:function(t){var e=this.objects.brightnessSlider,s=e.geometry.boundingBox,i=s.max.z-s.min.z;e.updateMatrixWorld(),e.worldToLocal(t);var r=1-(t.z-s.min.z)/i;r=THREE.MathUtils.clamp(1.29*r-.12,0,1),this.objects.hueWheel.material.uniforms.brightness.value=r,this.objects.brightnessCursor.rotation.y=1.5*r-1.5,this.hsv.v=r,this.updateColor(),this.playSound("ui_click0","brightness")},onBrushSizeBackgroundDown:function(t){var e=this.objects.sizeSlider,s=e.geometry.boundingBox,i=s.max.x-s.min.x;e.updateMatrixWorld(),e.worldToLocal(t);var r=(t.x-s.min.x)/i;r*=AFRAME.components.brush.schema.size.max,this.handEl.setAttribute("brush","size",r),this.playSound("ui_click0","sizebg")},handleHover:function(){this.updateHoverObjects(),this.updateMaterials()},updateHoverObjects:function(){this.hoveredOffObjects.length=0;for(const t of this.hoveredOnObjects)-1===this.intersectedObjects.indexOf(t)&&this.hoveredOffObjects.push(t);this.hoveredOnObjects.length=0;for(const t of this.intersectedObjects)"bb"!==t.object.name&&"msg_save"!==t.object.name&&this.hoveredOnObjects.push(t)},updateMaterials:(e=new THREE.Vector3,function(){var t=this.pressedObjects,s=this.unpressedObjects,i=this.selectedObjects;for(const t of this.hoveredOffObjects){const e=t.object;e.material=this.highlightMaterials[e.name].normal}for(const t of this.hoveredOnObjects){const s=t.object;e.copy(t.point),this.highlightMaterials[s.name]||this.initHighlightMaterial(s),s.material=this.highlightMaterials[s.name].hover,this.handEl.object3D.worldToLocal(e),this.handEl.setAttribute("line","end",e)}for(const e in t){const s=t[e],i=this.highlightMaterials[s.name];s.material=i.pressed||s.material}for(const t in s){const e=s[t],i=this.highlightMaterials[e.name];e.material=i.normal,delete s[t]}for(const t in i){const e=i[t],s=this.highlightMaterials[e.name];s&&(e.material=s.selected)}}),addToggleEvent:function(){this.el.addEventListener("toggleMenu",this.toggleMenu)},removeToggleEvent:function(){this.el.removeEventListener("toggleMenu",this.toggleMenu)},play:function(){var t=this.el,e=this.handEl;this.controller&&this.addToggleEvent(),t.addEventListener("model-loaded",this.onModelLoaded),t.addEventListener("raycaster-intersection",this.onIntersection),t.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),t.addEventListener("raycaster-intersected",this.onIntersected),t.addEventListener("raycaster-intersected-cleared",this.onIntersectedCleared),e&&this.addHandListeners()},pause:function(){var t=this.el,e=this.handEl;this.controller&&this.removeToggleEvent(),t.removeEventListener("raycaster-intersection",this.onIntersection),t.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),t.removeEventListener("raycaster-intersected",this.onIntersected),t.removeEventListener("raycaster-intersected-cleared",this.onIntersectedCleared),e&&this.removeHandListeners()},onModelLoaded:function(t){var e=this.uiEl.getObject3D("mesh");if(e=t.detail.model,"obj"===t.detail.format&&e.getObjectByName("brightnesscursor")){this.objects={},this.objects.brightnessCursor=e.getObjectByName("brightnesscursor"),this.objects.brightnessSlider=e.getObjectByName("brightness"),this.objects.brightnessSlider.geometry.computeBoundingBox(),this.objects.previousPage=e.getObjectByName("brushprev"),this.objects.nextPage=e.getObjectByName("brushnext"),this.objects.hueCursor=e.getObjectByName("huecursor"),this.objects.hueWheel=e.getObjectByName("hue"),this.objects.hueWheel.geometry.computeBoundingSphere(),this.colorWheelSize=this.objects.hueWheel.geometry.boundingSphere.radius,this.objects.sizeCursor=e.getObjectByName("size"),this.objects.sizeCursor.position.copy(this.cursorOffset),this.objects.colorHistory=[];for(var s=0;s<7;s++)this.objects.colorHistory[s]=e.getObjectByName("colorhistory"+s);this.objects.currentColor=e.getObjectByName("currentcolor"),this.objects.sizeSlider=e.getObjectByName("sizebg"),this.objects.sizeSlider.geometry.computeBoundingBox(),e.getObjectByName("bb").material=new THREE.MeshBasicMaterial({color:2395940,alphaTest:0,visible:!1});var i=this;this.messagesMaterial=new THREE.MeshBasicMaterial({map:null,transparent:!0,opacity:0}),this.objects.messageSave=e.getObjectByName("msg_save"),this.objects.messageSave.material=this.messagesMaterial,this.objects.messageSave.visible=!1,this.objects.messageError=e.getObjectByName("msg_error"),this.objects.messageError.visible=!1,this.objects.messageError.material=this.messagesMaterial;var r="assets/images/messages.png";this.el.sceneEl.systems.material.loadTexture(r,{src:r},(function(t){var e=i.messagesMaterial;e.map=t,e.needsUpdate=!0})),this.el.setAttribute("animation__showmessage",{dur:500,property:"ui.opacity",from:0,to:1,startEvents:"showmessage"}),this.el.setAttribute("animation__hidemessage",{dur:500,delay:3e3,property:"ui.opacity",from:1,to:0,startEvents:"animationcomplete__showmessage"}),this.el.sceneEl.addEventListener("drawing-upload-completed",(function(t){a(i.objects.messageSave)})),this.el.sceneEl.addEventListener("drawing-upload-error",(function(t){a(i.objects.messageError)})),this.initColorWheel(),this.initColorHistory(),this.initBrushesMenu(),this.setCursorTransparency(),this.updateColorUI(this.el.getAttribute("brush").color),this.updateSizeSlider(this.el.getAttribute("brush").size)}function a(t){t.visible=!0,i.el.emit("showmessage")}},initBrushesMenu:function(){var t=this.objects.previousPage,e=this.objects.nextPage,s=Object.keys(AFRAME.BRUSHES);this.initHighlightMaterial(e),this.initHighlightMaterial(t),t.visible=!1,e.visible=!1,this.brushesPerPage=15,this.brushesPagesNum=Math.ceil(s.length/this.brushesPerPage),this.brushesPage=0,this.loadBrushes(this.brushesPage,this.brushesPerPage)},setCursorTransparency:function(){var t=this.objects.hueCursor,e=this.objects.brightnessCursor,s=this.objects.sizeCursor;s.material.alphaTest=.5,t.material.alphaTest=.5,e.material.alphaTest=.5,s.material.transparent=!0,t.material.transparent=!0,e.material.transparent=!0},loadBrushes:(t={},function(e,s){var i,r,a=0,n=this.uiEl.getObject3D("mesh"),o=Object.keys(AFRAME.BRUSHES),h=this;if(!(e<0||e>=this.brushesPagesNum))for(this.objects.previousPage.visible=0!==e,e===this.brushesPagesNum-1?this.objects.nextPage.visible=!1:this.objects.nextPage.visible=!0,r=0;r<s;r++)u(i=o[e*s+r],a,i&&AFRAME.BRUSHES[i].prototype.options.thumbnail),a+=1;function u(e,s,i){var r=e?(e.charAt(0).toUpperCase()+e.slice(1)).toLowerCase():void 0;function a(e){var i=n.getObjectByName("brush"+s);h.brushButtonsMapping["brush"+s]=r,function(e,s){var i=h.brushButtonsMapping[s.name],r=t[i]||new THREE.MeshBasicMaterial;e?(r.map=e,r.alphaTest=.5,r.transparent=!0):t[i]||(r.visible=!1),t[i]=r,h.highlightMaterials[s.name]={normal:r,hover:r,pressed:r,selected:r},s.material=r}(e,i)}!i||t[r]?a():h.el.sceneEl.systems.material.loadTexture(i,{src:i},a)}}),nextPage:function(){this.brushesPage>=this.brushesPagesNum-1||(this.brushesPage++,this.loadBrushes(this.brushesPage,this.brushesPerPage),this.playSound("ui_click1"))},previousPage:function(){0!==this.brushesPage&&(this.brushesPage--,this.loadBrushes(this.brushesPage,this.brushesPerPage),this.playSound("ui_click1"))},initHighlightMaterial:function(t){var e=t.name,s=this.brushRegexp.test(e),i=-1!==e.indexOf("history"),r="hue"===e||"huecursor"===e,a={normal:t.material,hover:t.material,pressed:t.material,selected:t.material};s||i||r||(a.normal=t.material,a.hover=t.material.clone(),a.hover.map=this.system.hoverTexture,a.selected=t.material.clone(),a.selected.map=this.system.pressedTexture,a.pressed=t.material.clone(),a.pressed.map=this.system.pressedTexture),this.highlightMaterials[e]=a},toggleMenu:function(t){this.closed?(this.system.closeAll(),this.open(),this.system.opened=this.el):(this.close(),this.system.opened=void 0)},open:function(){var t=this.uiEl;if(this.closed){if(this.uiEl.setAttribute("visible",!0),this.uiEl.setAttribute("animation",{dur:100,easing:"easeOutExpo",property:"scale",from:{x:0,y:0,z:0},to:{x:1,y:1,z:1}}),this.el.setAttribute("brush","enabled",!1),this.ray.visible=!1,this.closed=!1,this.tooltips)for(const e of this.tooltips)e.getAttribute("visible")&&t.parentEl.id!==e.parentEl.id&&(this.isTooltipPaused=!0,e.setAttribute("visible",!1));this.playSound("ui_menu")}},updateIntersections:function(){const t=this.handEl.components.raycaster,e=t.raycaster;t.updateOriginDirection(),this.intersectedObjects.length=0,e.intersectObjects(this.menuEls,!0,this.intersectedObjects)},onIntersection:function(){var t=this.closed&&this.system.opened;this.el.components.brush.active||(this.ray.visible=t,this.el.setAttribute("brush","enabled",!1))},onIntersected:function(t){var e=t.detail.el;e.components.ui&&(this.handEl&&this.removeHandListeners(),this.handEl=e,this.menuEls=this.uiEl.object3D.children,this.syncUI(),this.addHandListeners())},addHandListeners:function(){var t=this.handEl;t.addEventListener("componentchanged",this.onComponentChanged),t.addEventListener("stroke-started",this.onStrokeStarted),t.addEventListener("triggerchanged",this.onTriggerChanged)},removeHandListeners:function(){var t=this.handEl;t.removeEventListener("componentchanged",this.onComponentChanged),t.removeEventListener("stroke-started",this.onStrokeStarted),t.removeEventListener("triggerchanged",this.onTriggerChanged)},onComponentChanged:function(t){"brush"===t.detail.name&&this.syncUI()},syncUI:function(){var t;this.handEl&&this.objects&&(t=this.handEl.getAttribute("brush"),this.updateSizeSlider(t.size),this.updateColorUI(t.color),this.updateColorHistory())},initColorHistory:function(){for(var t,e=this.objects.currentColor,s=0;s<this.objects.colorHistory.length;s++)(t=this.objects.colorHistory[s]).material=t.material.clone(),t.material.map=this.system.selectedTexture;e.material=e.material.clone(),e.material.map=this.system.selectedTexture,this.updateColorHistory()},updateColorHistory:function(){var t=this.handEl&&this.handEl.getAttribute("brush").color,e=this.colorStack;t||(t=this.el.components.brush.schema.color.default),this.objects.currentColor.material.color.set(t);for(var s=0;s<e.length;s++)t=e[e.length-s-1],this.objects.colorHistory[s].material.color.set(t)},updateSizeSlider:function(t){var e=this.objects.sizeSlider.geometry.boundingBox,s=this.objects.sizeCursor,i=e.max.x-e.min.x,r=t/AFRAME.components.brush.schema.size.max,a=r*i;s.position.setX(a-this.cursorOffset.x);var n=r+.3;s.scale.set(n,1,n)},updateColorUI:function(t){var e=new THREE.Color(t),s=this.hsv=this.rgb2hsv(e.r,e.g,e.b),i=2*s.h*Math.PI,r=s.s*this.colorWheelSize,a=r*Math.cos(i),n=r*Math.sin(i);this.objects.hueCursor.position.setX(a),this.objects.hueCursor.position.setZ(-n),this.objects.hueWheel.material.uniforms.brightness.value=this.hsv.v,this.objects.brightnessCursor.rotation.y=1.5*this.hsv.v-1.5},updateBrushSelector:function(t){const e=this.brushButtonsMapping;for(const s in this.brushButtonsMapping)if(e[s]===t){this.selectBrushButton(s);break}},onIntersectionCleared:function(){this.checkMenuIntersections=!1,this.ray.visible=!1,this.el.setAttribute("brush","enabled",!0)},onIntersectedCleared:function(){this.handEl&&this.handEl.removeEventListener("triggerchanged",this.onTriggerChanged)},onStrokeStarted:function(){var t,e=this.colorStack;this.colorHasChanged&&(t=this.handEl.getAttribute("brush").color,this.colorHasChanged=!1,7===e.length&&e.shift(),e.push(t),this.syncUI())},close:function(){if(!this.closed){if(this.uiEl.setAttribute("animation",{dur:100,easing:"easeOutExpo",property:"scale",from:{x:1,y:1,z:1},to:{x:0,y:0,z:0}}),this.el.setAttribute("brush","enabled",!0),this.closed=!0,this.tooltips&&this.isTooltipPaused){this.isTooltipPaused=!1;for(const t of this.tooltips)t.setAttribute("visible",!0)}this.playSound("ui_menu")}},playSound:function(t,e){void 0!==e&&this.pressedObjects[e]||document.getElementById(t).play()}})},821:()=>{window.addEventListener("load",(function(t){var e=document.body;e.addEventListener("dragover",(function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}),!1),e.addEventListener("drop",(function(t){t.stopPropagation(),t.preventDefault();for(var e=t.dataTransfer.files,s=0;s<e.length;s++){var i=e[s];if(".apa"===i.name.substring(i.name.length-4).toLowerCase())(r=new FileReader).onload=function(t){document.querySelector("a-scene").systems.brush.loadBinary(t.target.result)},r.readAsArrayBuffer(i);else if(".json"===i.name.substring(i.name.length-5).toLowerCase()){var r;(r=new FileReader).onload=function(t){document.querySelector("a-scene").systems.brush.loadJSON(JSON.parse(t.target.result))},r.readAsText(i)}else".obj"===i.name.substring(i.name.length-4).toLowerCase()?((r=new FileReader).onload=function(t){for(var e=(new AFRAME.THREE.OBJLoader).parse(t.target.result),s=document.createElement("a-entity"),i=0;i<e.children.length;i++){var r=e.children[i];r.material.constructor===Array?r.material.forEach((t=>{t.color.set("#333")})):r.material.color.set("#333")}s.setObject3D("mesh",e),s.className="templateitem",document.querySelector("a-scene").appendChild(s)},r.readAsText(i)):i.type.match(/image.*/)&&((r=new FileReader).onload=function(t){var e=new Image;e.src=t.target.result,e.onload=()=>{var s,i;e.width>e.height?(s=1,i=e.height/e.width):(i=1,s=e.width/e.height);var r=[3*Math.random()-1.5,1+Math.random()-.5,.2*Math.random()-1.4],a=document.createElement("a-image");a.setAttribute("src",t.target.result),a.setAttribute("position",r.join(" ")),a.setAttribute("width",s),a.setAttribute("height",i),a.className="templateitem",document.querySelector("a-scene").appendChild(a)}},r.readAsDataURL(i))}}),!1)}))},51:t=>{t.exports=function(t){const e=document.querySelector("a-scene");if(e&&e.hasLoaded)t();else{const e=function(s){"A-SCENE"===s.target.tagName&&(t(),document.removeEventListener("renderstart",e))};document.addEventListener("renderstart",e)}}},115:t=>{function e(t){this.material=t,this.maxBufferSize=1e6,this.geometries=[],this.current=null,this.strip=!0,this.addBuffer(!1)}e.prototype={restartPrimitive:function(){if(this.idx.position>=this.current.attributes.position.count)this.addBuffer(!1);else if(0!==this.idx.position){var t=3*(this.idx.position-1),e=this.current.attributes.position.array;this.addVertex(e[t++],e[t++],e[t++]),this.idx.color++,this.idx.normal++,this.idx.uv++}},remove:function(t,e){var s=this.current.attributes.position.array;if(this.idx.position>e.position)for(key in this.idx)for(var i="uv"===key?2:3,r=(s=t[key]*i,(e[key]+1)*i),a=this.idx[key]*i,n=r;n<a;n++)this.current.attributes[key].array[s++]=this.current.attributes[key].array[n];for(key in this.idx){var o=e[key]-t[key];this.idx[key]-=o}this.update()},undo:function(t){for(let e=t.position;e<this.idx.position;e++)this.current.attributes.position.setXYZ(e,0,0,0),this.current.index.setXYZ(e,0,0,0);this.idx=t,this.update()},addBuffer:function(t){var e=new THREE.BufferGeometry,s=new Float32Array(3*this.maxBufferSize),i=new Uint32Array(4.5*this.maxBufferSize),r=new Float32Array(3*this.maxBufferSize),a=new Float32Array(2*this.maxBufferSize),n=new Float32Array(3*this.maxBufferSize),o=new THREE.Mesh(e,this.material);o.frustumCulled=!1,o.vertices=s,this.object3D=new THREE.Object3D;var h=document.querySelector(".a-drawing");if(h||((h=document.createElement("a-entity")).className="a-drawing",document.querySelector("a-scene").appendChild(h)),h.object3D.add(this.object3D),this.object3D.add(o),e.setDrawRange(0,0),e.setAttribute("position",new THREE.BufferAttribute(s,3).setUsage(THREE.DynamicDrawUsage)),e.setIndex(new THREE.BufferAttribute(i,3).setUsage(THREE.DynamicDrawUsage)),e.setAttribute("uv",new THREE.BufferAttribute(a,2).setUsage(THREE.DynamicDrawUsage)),e.setAttribute("normal",new THREE.BufferAttribute(r,3).setUsage(THREE.DynamicDrawUsage)),e.setAttribute("color",new THREE.BufferAttribute(n,3).setUsage(THREE.DynamicDrawUsage)),this.previous=null,this.geometries.length>0&&(this.previous=this.current),this.idx={position:0,uv:0,normal:0,color:0},this.geometries.push(e),this.current=e,this.previous&&t){var u=3*(this.maxBufferSize-2),d=3*(this.maxBufferSize-2),l=(this.maxBufferSize,3*(this.maxBufferSize-2)),c=this.previous.attributes.position.array;this.addVertex(c[u++],c[u++],c[u++]),this.addVertex(c[u++],c[u++],c[u++]);var m=this.previous.attributes.normal.array;this.addNormal(m[l++],m[l++],m[l++]),this.addNormal(m[l++],m[l++],m[l++]);var p=this.previous.attributes.color.array;this.addColor(p[d++],p[d++],p[d++]),this.addColor(p[d++],p[d++],p[d++]);a=this.previous.attributes.uv.array}},addColor:function(t,e,s){this.current.attributes.color.setXYZ(this.idx.color++,t,e,s)},addNormal:function(t,e,s){this.current.attributes.normal.setXYZ(this.idx.normal++,t,e,s)},addVertex:function(t,e,s){var i=this.current.attributes.position;this.idx.position===i.count&&(this.addBuffer(!0),i=this.current.attributes.position),i.setXYZ(this.idx.position++,t,e,s),this.strip?(this.idx.position+1)%2==0&&this.idx.position>1&&(this.current.index.setXYZ(this.idx.position-3,this.idx.position-3,this.idx.position-2,this.idx.position-1),this.current.index.setXYZ(this.idx.position-2,this.idx.position-1,this.idx.position-2,this.idx.position)):(this.idx.position+1)%3==0&&this.current.index.setXYZ(this.idx.position,this.idx.position-2,this.idx.position-1,this.idx.position)},addUV:function(t,e){this.current.attributes.uv.setXY(this.idx.uv++,t,e)},update:function(){this.current.setDrawRange(0,3*this.idx.position-4),0===this.current.attributes.color.updateRanges.length&&this.current.attributes.color.addUpdateRange(0,0),this.current.attributes.color.updateRanges[0].count=3*this.idx.position,this.current.attributes.color.needsUpdate=!0,0===this.current.attributes.normal.updateRanges.length&&this.current.attributes.normal.addUpdateRange(0,0),this.current.attributes.normal.updateRanges[0].count=3*this.idx.position,this.current.attributes.normal.needsUpdate=!0,0===this.current.attributes.position.updateRanges.length&&this.current.attributes.position.addUpdateRange(0,0),this.current.attributes.position.updateRanges[0].count=3*this.idx.position,this.current.attributes.position.needsUpdate=!0,0===this.current.attributes.uv.updateRanges.length&&this.current.attributes.uv.addUpdateRange(0,0),this.current.attributes.uv.updateRanges[0].count=2*this.idx.position,this.current.attributes.uv.needsUpdate=!0,0===this.current.index.updateRanges.length&&this.current.index.addUpdateRange(0,0),this.current.index.updateRanges[0].count=3*this.idx.position,this.current.index.needsUpdate=!0}},t.exports=e},297:(t,e,s)=>{var i=s(115);function r(){this.sharedBuffers={}}r.prototype={addSharedBuffer:function(t,e){var s=new i(e);this.sharedBuffers[t]=s},getSharedBuffer:function(t){return this.sharedBuffers[t]}},t.exports=new r},796:()=>{AFRAME.BRUSHES={},APAINTER_STATS={brushes:{}},AFRAME.registerBrush=function(t,e,s){var i={};for(const t in e)i[t]={value:e[t],writable:!0};if(AFRAME.BRUSHES[t])throw new Error("The brush `"+t+"` has been already registered. Check that you are not loading two versions of the same brush or two different brushes of the same name.");var r=function(){};r.prototype={options:Object.assign({spacing:0,maxPoints:0},s),reset:function(){},tick:function(t,e){},undo:function(){},remove:function(){},addPoint:function(t,e,s,i,r){},getJSON:function(t){for(var e=[],s=0;s<this.data.points.length;s++){var i=this.data.points[s];e.push({orientation:Utils.arrayNumbersToFixed(i.orientation.toArray()),position:Utils.arrayNumbersToFixed(i.position.toArray()),pressure:Utils.numberToFixed(i.pressure),timestamp:i.timestamp})}return{brush:{index:t.getUsedBrushes().indexOf(this.brushName),color:Utils.arrayNumbersToFixed(this.data.color.toArray()),size:Utils.numberToFixed(this.data.size)},points:e}},getBinary:function(t){var e=21+36*this.data.points.length,s=new BinaryManager(new ArrayBuffer(e));s.writeUint8(t.getUsedBrushes().indexOf(this.brushName)),s.writeColor(this.data.color),s.writeFloat32(this.data.size),s.writeUint32(this.data.points.length);for(var i=0;i<this.data.points.length;i++){var r=this.data.points[i];s.writeFloat32Array(r.position.toArray()),s.writeFloat32Array(r.orientation.toArray()),s.writeFloat32(r.pressure),s.writeUint32(r.timestamp)}return s.getDataView()}};var a,n,o=function(){};return(o.prototype=Object.create(r.prototype,i)).brushName=t,o.prototype.constructor=o,o.prototype.init=(a=o.prototype.init,function(t,e,s,i){this.object3D=new THREE.Object3D,this.data={points:[],size:e,prevPosition:null,prevPointerPosition:null,numPoints:0,color:t.clone(),timestamp:i,owner:s},a.call(this,t,e)}),o.prototype.addPoint=(n=o.prototype.addPoint,function(t,e,s,i,r){this.data.prevPosition&&this.data.prevPosition.distanceTo(t)<=this.options.spacing||0!==this.options.maxPoints&&this.data.numPoints>=this.options.maxPoints||n.call(this,t,e,s,i,r)&&(this.data.numPoints++,this.data.points.push({position:t.clone(),orientation:e.clone(),pressure:i,timestamp:r}),this.data.prevPosition=t.clone(),this.data.prevPointerPosition=s.clone())}),AFRAME.BRUSHES[t]=o,o.used=!1,o},AFRAME.registerSystem("brush",{schema:{},brushes:{},strokes:[],getUsedBrushes:function(){return Object.keys(AFRAME.BRUSHES).filter((function(t){return AFRAME.BRUSHES[t].used}))},getBrushByName:function(t){return AFRAME.BRUSHES[t]},undo:function(t){var e;t=t||"local";for(var s=this.strokes.length-1;s>=0;s--)if(this.strokes[s].data.owner===t){e=this.strokes.splice(s,1)[0];break}e&&(e.undo(),document.querySelector(".a-drawing").emit("stroke-removed",{stroke:e}))},removeById:function(t){var e=this.strokes[1];if(console.log(e,this.strokes),e){for(var s=this.strokes.length-1;s>1;s--)if(stroke=this.strokes[s],e.sharedBuffer===stroke.sharedBuffer){for(key in console.log(">>>",stroke.prevIdx,"->",stroke.idx,"target",e.prevIdx,"->",e.idx),e.idx){var i=e.idx[key]-e.prevIdx[key];stroke.idx[key]-=i,stroke.prevIdx[key]-=i}console.log("<<<",stroke.idx,stroke.prevIdx)}this.strokes.splice(1,1)[0].remove()}},clear:function(t){t=t||"local";for(var e=this.strokes.length-1;e>=0;e--)if(this.strokes[e].data.owner===t){var s=this.strokes[e];s.undo(),document.querySelector(".a-drawing").emit("stroke-removed",{stroke:s})}for(const t in AFRAME.BRUSHES)AFRAME.BRUSHES[t].used=!1;this.strokes.length=0},init:function(){this.version=1,this.clear()},tick:function(t,e){for(const s of this.strokes)s.tick(t,e)},generateTestLines:function(){var t=Object.keys(AFRAME.BRUSHES);brushesNames2=["leaf1","fur2","star","squared-textured","flat","squared-textured","lines5"];var e=-.6*t.length/2;e=0;t.forEach((function(t){var s=new THREE.Color(Math.random(),Math.random(),Math.random()),i=this.addNewStroke(t,s,.5),r=document.querySelector("#left-hand");r.emit("stroke-started",{entity:r,stroke:i});for(var a=new THREE.Vector3(e,0,-2),n=new THREE.Vector3,o=0;o<4;o++){var h=new THREE.Quaternion;n.set(0,.75,.1);var u=new THREE.Euler(0,Math.PI,0);h.setFromEuler(u),a=a.add(n);var d=this.getPointerPosition(a,h);i.addPoint(a,h,d,1,0)}e+=.6}))},generateRandomStrokes:function(t){function e(){return 2*Math.random()-1}for(var s=document.querySelector("#left-hand"),i=Object.keys(AFRAME.BRUSHES),r=0;r<t;r++){var a=i[parseInt(13*Math.random())],n=new THREE.Color(Math.random(),Math.random(),Math.random()),o=.3*Math.random(),h=parseInt(500*Math.random()),u=this.addNewStroke(a,n,o);s.emit("stroke-started",{entity:s,stroke:u});for(var d=new THREE.Vector3(e(),e(),e()),l=new THREE.Vector3,c=new THREE.Quaternion,m=.2,p=0;p<h;p++){l.set(e(),e(),e()),l.multiplyScalar(e()/20),c.setFromUnitVectors(d.clone().normalize(),l.clone().normalize()),(d=d.add(l)).y<0&&(d.y=-d.y);(m+=1-2*Math.random())<0&&(m=.2),m>1&&(m=1);var f=this.getPointerPosition(d,c);u.addPoint(d,c,f,m,0)}}},addNewStroke:function(t,e,s,i,r){APAINTER_STATS.brushes[t]||(APAINTER_STATS.brushes[t]=0),APAINTER_STATS.brushes[t]++,i=i||"local",r=r||Date.now();var a=this.getBrushByName(t);if(!a){var n=Object.keys(AFRAME.BRUSHES)[0];a=AFRAME.BRUSHES[n],console.warn("Invalid brush name: `"+t+"` using `"+n+"`")}a.used=!0;var o=new a;o.brush=a,o.init(e,s,i,r),this.strokes.push(o);var h=document.querySelector(".a-drawing");return h||((h=document.createElement("a-entity")).className="a-drawing",document.querySelector("a-scene").appendChild(h)),o},getJSON:function(){var t={version:1,strokes:[],author:"",brushes:this.getUsedBrushes()};for(i=0;i<this.strokes.length;i++)t.strokes.push(this.strokes[i].getJSON(this));return t},getBinary:function(){var t=[],e="apainter",s=this.getUsedBrushes(),i=e.length+s.join(" ").length+9,r=new BinaryManager(new ArrayBuffer(i));r.writeString(e),r.writeUint16(1),r.writeUint8(s.length);for(var a=0;a<s.length;a++)r.writeString(s[a]);for(r.writeUint32(this.strokes.length),t.push(r.getDataView()),a=0;a<this.strokes.length;a++)t.push(this.strokes[a].getBinary(this));return t},getPointerPosition:function(){const t={left:null,right:null};return window.addEventListener("model-loaded",(function(e){"left-tip"===e.target.id?(t.left=e.target.object3D,e.detail.model.traverse((function(e){"sizehint"===e.name&&(t.left=e)}))):"right-tip"===e.target.id&&(t.right=e.target.object3D,e.detail.model.traverse((function(e){"sizehint"===e.name&&(t.right=e)})))})),function(e,s,i){return"undfined"!=typeof i&&t[i]&&t[i].getWorldPosition(e),e}}(),loadJSON:function(t){1!==t.version&&console.error("Invalid version: ",t.version,"(Expected: 1)"),console.time("JSON Loading");for(var e=0;e<t.strokes.length;e++)for(var s=t.strokes[e],i=s.brush,r=this.addNewStroke(t.brushes[i.index],(new THREE.Color).fromArray(i.color),i.size),a=0;a<s.points.length;a++){var n=s.points[a],o=(new THREE.Vector3).fromArray(n.position),h=(new THREE.Quaternion).fromArray(n.orientation),u=n.pressure,d=n.timestamp,l=this.getPointerPosition(o,h);r.addPoint(o,h,l,u,d)}console.timeEnd("JSON Loading")},loadBinary:function(t){var e=new BinaryManager(t);if("apainter"===e.readString()){var s=e.readUint16();1!==s&&console.error("Invalid version: ",s,"(Expected: 1)"),console.time("Binary Loading");for(var i=e.readUint8(),r=[],a=0;a<i;a++)r.push(e.readString());for(var n=e.readUint32(),o=0;o<n;o++)for(var h=e.readUint8(),u=e.readColor(),d=e.readFloat(),l=e.readUint32(),c=this.addNewStroke(r[h],u,d),m=0;m<l;m++){var p=e.readVector3(),f=e.readQuaternion(),g=e.readFloat(),b=e.readUint32(),v=this.getPointerPosition(p,f);c.addPoint(p,f,v,g,b)}console.timeEnd("Binary Loading")}else console.error("Invalid `magic` header")},loadFromUrl:function(t,e){var s=new THREE.FileLoader(this.manager);s.crossOrigin="anonymous",!0===e&&s.setResponseType("arraybuffer");var i=this;s.load(t,(function(t){!0===e?i.loadBinary(t):i.loadJSON(JSON.parse(t))}))}})},810:(t,e,s)=>{var i=s(618).saveAs;AFRAME.registerSystem("painter",{init:function(){var t={behaviours:{},mappings:{painting:{common:{"grip.down":"undo","trigger.changed":"paint"},"vive-controls":{axismove:"changeBrushSizeInc","trackpad.touchstart":"startChangeBrushSize","menu.down":"toggleMenu","trackpad.down":"aim","trackpad.up":"teleport"},"oculus-touch-controls":{axismove:"changeBrushSizeAbs","abutton.down":"toggleMenu","xbutton.down":"toggleMenu","ybutton.down":"aim","ybutton.up":"teleport","bbutton.down":"aim","bbutton.up":"teleport"},"windows-motion-controls":{axismove:"changeBrushSizeAbs","menu.down":"toggleMenu","trackpad.down":"aim","trackpad.up":"teleport"}}}};this.sceneEl.addEventListener("loaded",(function(){AFRAME.registerInputMappings(t),AFRAME.currentInputMapping="painting"})),this.version="1.2",this.brushSystem=this.sceneEl.systems.brush,this.showTemplateItems=!0;var e=function(){var t,e=/\+/g,s=/([^&=]+)=?([^&]*)/g,i=function(t){return decodeURIComponent(t.replace(e," "))},r=window.location.search.substring(1),a={};for(t=s.exec(r);t;)a[i(t[1])]=i(t[2]),t=s.exec(r);return a}();const s=document.querySelector("a-camera, [camera]");if(e.url||e.urljson){var i=void 0===e.urljson;this.brushSystem.loadFromUrl(e.url||e.urljson,i),document.getElementById("logo")?.setAttribute("visible",!1),s.setAttribute("orbit-controls","initialPosition: 0 1.6 3"),document.getElementById("apainter-logo")?.classList.remove("hidden")}else s.setAttribute("position","0 1.6 0");void 0!==e.bgcolor&&(document.body.style.backgroundColor="#"+e.bgcolor),void 0!==e.sky&&this.sceneEl.addEventListener("loaded",(function(t){""===e.sky?document.getElementById("sky").setAttribute("visible",!1):document.getElementById("sky").setAttribute("material","src",e.sky)})),void 0!==e.floor&&this.sceneEl.addEventListener("loaded",(function(t){""===e.floor?document.getElementById("ground").setAttribute("visible",!1):document.getElementById("ground").setAttribute("material","src",e.floor)})),this.paintingStarted=!1;var r=this;document.addEventListener("stroke-started",(function(t){if(!r.paintingStarted){document.getElementById("logo")?.emit("painting-started"),r.paintingStarted=!0}})),document.addEventListener("keyup",(function(t){if(!t.shiftKey&&!t.ctrlKey){if(8===t.keyCode&&r.brushSystem.undo(),67===t.keyCode&&r.brushSystem.clear(),71===t.keyCode){var e=document.querySelector(".a-drawing");r.sceneEl.systems["gltf-exporter"].export(e)}if(78===t.keyCode){var s=document.querySelectorAll("[paint-controls]"),i=Object.keys(AFRAME.BRUSHES),a=i.indexOf(s[0].components.brush.data.brush);a=(a+1)%i.length,[].forEach.call(s,(function(t){t.setAttribute("brush","brush",i[a])}))}if(84===t.keyCode&&r.brushSystem.generateTestLines(),82===t.keyCode&&r.brushSystem.generateRandomStrokes(1),76===t.keyCode&&r.brushSystem.loadFromUrl("demo.apa",!0),85===t.keyCode&&r.upload(),86===t.keyCode&&r.save(),74===t.keyCode&&r.saveJSON(),79===t.keyCode){r.showTemplateItems=!r.showTemplateItems;for(var n=document.querySelectorAll(".templateitem"),o=0;o<n.length;o++)n[o].setAttribute("visible",r.showTemplateItems)}88===t.keyCode&&r.brushSystem.removeById(2)}})),console.info("A-PAINTER Version: "+this.version)},saveJSON:function(){var t=this.brushSystem.getJSON(),e=new Blob([JSON.stringify(t)],{type:"application/json"});i(e,"demo.json")},save:function(){var t=this.brushSystem.getBinary(),e=new Blob(t,{type:"application/octet-binary"});i(e,"demo.apa")},upload:function(){this.sceneEl.emit("drawing-upload-started");var t=this,e="https://aframe.io/a-painter/?url=",s=this.brushSystem.getBinary(),i=new Blob(s,{type:"application/octet-binary"});const r=new FormData;r.append("upload_preset","upload_painting"),r.append("file",i),fetch("https://api.cloudinary.com/v1_1/a-painter/upload",{method:"POST",body:r}).then((t=>{if(!t.ok)throw new Error(`Network request failed with status ${t.status}: ${t.statusText}`);return t.json()})).then((s=>{console.log("Uploaded link: ",e+s.secure_url),t.sceneEl.emit("drawing-upload-completed",{url:e+s.secure_url})})).catch((e=>{console.error(e),t.sceneEl.emit("drawing-upload-error",{errorInfo:e})}))}})},493:()=>{AFRAME.registerSystem("ui",{init:function(){this.initTextures()},initTextures:function(){var t=this,e="assets/images/ui-hover.png",s="assets/images/ui-pressed.png";this.sceneEl.systems.material.loadTexture(e,{src:e},(function(e){t.hoverTexture=e})),this.sceneEl.systems.material.loadTexture(s,{src:s},(function(e){t.pressedTexture=e}))},closeAll:function(){var t,e=document.querySelectorAll("[ui]");for(t=0;t<e.length;t++)e[t].components.ui.close()}})},369:()=>{window.addEventListener("load",(function(t){var e=document.getElementById("apainter-ui"),s=document.querySelector("#apainter-ui .share"),i=document.getElementById("apainter-share-url"),r=document.querySelector("#apainter-ui .progress"),a=document.querySelector("#apainter-ui .bar");document.addEventListener("drawing-upload-completed",(function(t){s.classList.remove("hide"),r.classList.add("hide"),i.value=t.detail.url})),document.addEventListener("drawing-upload-started",(function(t){e.style.display="block",s.classList.add("hide"),r.classList.remove("hide")})),document.addEventListener("drawing-upload-progress",(function(t){a.style.width=Math.floor(100*t.detail.progress)+"%"})),new Clipboard(".button.copy").on("error",(function(t){console.error("Error copying to clipboard:",t.action,t.trigger)}))}))},555:()=>{window.Utils=function(){function t(t){return parseFloat(t.toFixed(6))}return{numberToFixed:t,arrayNumbersToFixed:function(e){for(var s=0;s<e.length;s++)e[s]=t(e[s]);return e},getTooltips:function(t){var e;switch(t){case"windows-motion-samsung-controls":e=".windows-motion-samsung-tooltips";break;case"windows-motion-controls":e=".windows-motion-tooltips";break;case"oculus-touch-controls":e=".oculus-tooltips";break;case"vive-controls":e=".vive-tooltips"}return Array.prototype.slice.call(document.querySelectorAll(e))}}}()},618:function(t,e,s){var i,r=r||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,s=function(){return t.URL||t.webkitURL||t},i=e.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in i,a=/constructor/i.test(t.HTMLElement),n=/CriOS\/[\d]+/.test(navigator.userAgent),o=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},h=function(t){setTimeout((function(){"string"==typeof t?s().revokeObjectURL(t):t.remove()}),4e4)},u=function(t,e,s){for(var i=(e=[].concat(e)).length;i--;){var r=t["on"+e[i]];if("function"==typeof r)try{r.call(t,s||t)}catch(t){o(t)}}},d=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},l=function(e,o,l){l||(e=d(e));var c,m=this,p="application/octet-stream"===e.type,f=function(){u(m,"writestart progress write writeend".split(" "))};if(m.readyState=m.INIT,r)return c=s().createObjectURL(e),void setTimeout((function(){i.href=c,i.download=o,function(t){var e=new MouseEvent("click");t.dispatchEvent(e)}(i),f(),h(c),m.readyState=m.DONE}));!function(){if((n||p&&a)&&t.FileReader){var i=new FileReader;return i.onloadend=function(){var e=n?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,m.readyState=m.DONE,f()},i.readAsDataURL(e),void(m.readyState=m.INIT)}(c||(c=s().createObjectURL(e)),p)?t.location.href=c:t.open(c,"_blank")||(t.location.href=c);m.readyState=m.DONE,f(),h(c)}()},c=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,s){return e=e||t.name||"download",s||(t=d(t)),navigator.msSaveOrOpenBlob(t,e)}:(c.abort=function(){},c.readyState=c.INIT=0,c.WRITING=1,c.DONE=2,c.error=c.onwritestart=c.onprogress=c.onwrite=c.onabort=c.onerror=c.onwriteend=null,function(t,e,s){return new l(t,e||t.name||"download",s)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */t.exports?t.exports.saveAs=r:null!==s.amdD&&null!==s.amdO&&(void 0===(i=function(){return r}.apply(e,[]))||(t.exports=i))},95:t=>{"use strict";t.exports=JSON.parse('{"meta":{"image":"brush_atlas.png","size":{"w":3584,"h":2944},"scale":"1"},"frames":{"stamp_grass.png":{"frame":{"x":0,"y":128,"w":1536,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1536,"h":512},"sourceSize":{"w":1536,"h":512}},"lines4.png":{"frame":{"x":0,"y":0,"w":2048,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":2048,"h":128},"sourceSize":{"w":2048,"h":128}},"stamp_fur2.png":{"frame":{"x":0,"y":640,"w":1536,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1536,"h":512},"sourceSize":{"w":1536,"h":512}},"stamp_bush.png":{"frame":{"x":0,"y":1152,"w":1024,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":512},"sourceSize":{"w":1024,"h":512}},"stamp_gear.png":{"frame":{"x":1024,"y":1152,"w":1024,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":512},"sourceSize":{"w":1024,"h":512}},"stamp_fur1.png":{"frame":{"x":2048,"y":0,"w":1024,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":512},"sourceSize":{"w":1024,"h":512}},"lines3.png":{"frame":{"x":2048,"y":512,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"line_gradient.png":{"frame":{"x":2048,"y":768,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"lines5.png":{"frame":{"x":2048,"y":1024,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"silky_flat.png":{"frame":{"x":2048,"y":1280,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"silky_textured.png":{"frame":{"x":0,"y":1664,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"squared_textured.png":{"frame":{"x":1024,"y":1664,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"line_grunge2.png":{"frame":{"x":2048,"y":1664,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"line_grunge3.png":{"frame":{"x":0,"y":1920,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"line_grunge1.png":{"frame":{"x":1024,"y":1920,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"lines2.png":{"frame":{"x":2048,"y":1920,"w":1024,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":1024,"h":256},"sourceSize":{"w":1024,"h":256}},"stamp_leaf3.png":{"frame":{"x":1536,"y":128,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_dots.png":{"frame":{"x":1536,"y":640,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"thumb_stamp_star.png":{"frame":{"x":2304,"y":1536,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"stamp_grunge1.png":{"frame":{"x":512,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_grunge2.png":{"frame":{"x":1024,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_grunge3.png":{"frame":{"x":1536,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_grunge4.png":{"frame":{"x":2048,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_grunge5.png":{"frame":{"x":2560,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_leaf1.png":{"frame":{"x":3072,"y":0,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_leaf2.png":{"frame":{"x":3072,"y":512,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_column.png":{"frame":{"x":3072,"y":1024,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_snow.png":{"frame":{"x":3072,"y":1536,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"stamp_squares.png":{"frame":{"x":3072,"y":2048,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}},"lines1.png":{"frame":{"x":0,"y":2688,"w":256,"h":256},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":256,"h":256},"sourceSize":{"w":256,"h":256}},"thumb_rainbow.png":{"frame":{"x":3072,"y":2560,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_single_sphere.png":{"frame":{"x":3200,"y":2560,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_stamp_fur1.png":{"frame":{"x":3328,"y":2560,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_stamp_fur2.png":{"frame":{"x":3456,"y":2560,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_stamp_grass.png":{"frame":{"x":2048,"y":1536,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"thumb_stamp_snow.png":{"frame":{"x":2176,"y":1536,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128}},"stamp_star.png":{"frame":{"x":0,"y":2176,"w":512,"h":512},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":512,"h":512},"sourceSize":{"w":512,"h":512}}}}')}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,s),a.exports}s.amdD=function(){throw new Error("define cannot be used indirect")},s.amdO={},window.saveAs=s(618).saveAs,s(453),s(821),s(967),s(297),s(115),s(555),s(369),s(796),s(493),s(810),s(620),s(142),s(510),s(101),s(688),s(788),s(295),s(623),s(988),s(830),s(775),s(891)})();