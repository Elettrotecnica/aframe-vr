!function(e){"use strict";class t extends e.Mesh{constructor(t){const s=new o(t),n=new e.PlaneGeometry(.001*s.image.width,.001*s.image.height),r=new e.MeshBasicMaterial({map:s,toneMapped:!1,transparent:!0});function l(e){r.map.dispatchDOMEvent(e)}super(n,r),this.addEventListener("mousedown",l),this.addEventListener("mousemove",l),this.addEventListener("mouseup",l),this.addEventListener("click",l),this.dispose=function(){n.dispose(),r.dispose(),r.map.dispose(),i.delete(t),this.removeEventListener("mousedown",l),this.removeEventListener("mousemove",l),this.removeEventListener("mouseup",l),this.removeEventListener("click",l)}}}class o extends e.CanvasTexture{constructor(t){super(s(t)),this.dom=t,this.anisotropy=16,"147"===THREE.REVISION?this.encoding=e.sRGBEncoding:this.colorSpace=e.SRGBColorSpace,this.minFilter=e.LinearFilter,this.magFilter=e.LinearFilter;const o=new MutationObserver((()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout((()=>this.update()),16))}));o.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.observer=o}dispatchDOMEvent(e){e.data&&function(e,t,o,i){const s={clientX:o*e.offsetWidth+e.offsetLeft,clientY:i*e.offsetHeight+e.offsetTop,view:e.ownerDocument.defaultView},n=e.getBoundingClientRect();function r(e){if(e.nodeType!==Node.TEXT_NODE&&e.nodeType!==Node.COMMENT_NODE){const n=e.getBoundingClientRect();if(o>n.left&&o<n.right&&i>n.top&&i<n.bottom&&(e.dispatchEvent(new MouseEvent(t,s)),e instanceof HTMLInputElement&&"range"===e.type&&("mousedown"===t||"click"===t))){const[t,i]=["min","max"].map((t=>parseFloat(e[t]))),s=n.width,r=(o-n.x)/s;e.value=t+(i-t)*r,e.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let t=0;t<e.childNodes.length;t++)r(e.childNodes[t])}}o=o*n.width+n.left,i=i*n.height+n.top,r(e)}(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=s(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const i=new WeakMap;function s(t){const o=document.createRange(),s=new e.Color;function n(e,t,o,i,s){if(""!==i)if("uppercase"===e.textTransform&&(i=i.toUpperCase()),d.font=e.fontWeight+" "+e.fontSize+" "+e.fontFamily,d.textBaseline="top",d.fillStyle=e.color,s){const n=function(e,t,o){const i=t.split(" "),s=[];let n=i[0];for(let t=1;t<i.length;t++){const r=i[t];e.measureText(n+" "+r).width<o?n+=" "+r:(s.push(n),n=r)}return s.push(n),s}(d,i,s);n.forEach((function(i,s){d.fillText(i,t,o+.1*parseFloat(e.fontSize)+s*parseFloat(e.fontSize)*1.3)}))}else d.fillText(i,t,o+.1*parseFloat(e.fontSize))}function r(e,t,o,i,s){o<2*s&&(s=o/2),i<2*s&&(s=i/2),d.beginPath(),d.moveTo(e+s,t),d.arcTo(e+o,t,e+o,t+i,s),d.arcTo(e+o,t+i,e,t+i,s),d.arcTo(e,t+i,e,t,s),d.arcTo(e,t,e+o,t,s),d.closePath()}function l(e,t,o,i,s,n){const r=e[t+"Width"],l=e[t+"Style"],a=e[t+"Color"];"0px"!==r&&"none"!==l&&"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&(d.strokeStyle=a,d.lineWidth=parseFloat(r),d.beginPath(),d.moveTo(o,i),d.lineTo(o+s,i+n),d.stroke())}const a=t.getBoundingClientRect();let h=i.get(t);void 0===h&&(h=document.createElement("canvas"),h.width=a.width,h.height=a.height,i.set(t,h));const d=h.getContext("2d"),c=new function(e){const t=[];let o=!1;function i(){if(o&&(o=!1,e.restore()),0===t.length)return;let i=-1/0,s=-1/0,n=1/0,r=1/0;for(let e=0;e<t.length;e++){const o=t[e];i=Math.max(i,o.x),s=Math.max(s,o.y),n=Math.min(n,o.x+o.width),r=Math.min(r,o.y+o.height)}e.save(),e.beginPath(),e.rect(i,s,n-i,r-s),e.clip(),o=!0}return{add:function(e){t.push(e),i()},remove:function(){t.pop(),i()}}}(d);return d.clearRect(0,0,h.width,h.height),function e(t,i){if(t.nodeType===Node.COMMENT_NODE||"SCRIPT"===t.nodeName||t.style&&"none"===t.style.display)return;let h=0,u=0,p=0,m=0;if(t.nodeType===Node.TEXT_NODE){o.selectNode(t);const e=o.getBoundingClientRect();h=e.left-a.left-.5,u=e.top-a.top-.5,p=e.width,m=e.height;const s=1.01*p;n(i,h,u,t.nodeValue.trim(),s)}else if(t instanceof HTMLCanvasElement){const e=t.getBoundingClientRect();h=e.left-a.left-.5,u=e.top-a.top-.5,d.save();const o=window.devicePixelRatio;d.scale(1/o,1/o),d.drawImage(t,h,u),d.restore()}else if(t instanceof HTMLImageElement){const e=t.getBoundingClientRect();h=e.left-a.left-.5,u=e.top-a.top-.5,p=e.width,m=e.height,d.drawImage(t,h,u,p,m)}else{const e=t.getBoundingClientRect();h=e.left-a.left-.5,u=e.top-a.top-.5,p=e.width,m=e.height,i=window.getComputedStyle(t),r(h,u,p,m,parseFloat(i.borderRadius));const o=i.backgroundColor;"transparent"!==o&&"rgba(0, 0, 0, 0)"!==o&&(d.fillStyle=o,d.fill());const f=["borderTop","borderLeft","borderBottom","borderRight"];let v=!0,g=null;for(const e of f){if(null!==g&&(v=i[e+"Width"]===i[g+"Width"]&&i[e+"Color"]===i[g+"Color"]&&i[e+"Style"]===i[g+"Style"]),!1===v)break;g=e}if(!0===v){const e=parseFloat(i.borderTopWidth);"0px"!==i.borderTopWidth&&"none"!==i.borderTopStyle&&"transparent"!==i.borderTopColor&&"rgba(0, 0, 0, 0)"!==i.borderTopColor&&(d.strokeStyle=i.borderTopColor,d.lineWidth=e,d.stroke())}else l(i,"borderTop",h,u,p,0),l(i,"borderLeft",h,u,0,m),l(i,"borderBottom",h,u+m,p,0),l(i,"borderRight",h+p,u,0,m);if(t instanceof HTMLInputElement){let e=i.accentColor;void 0!==e&&"auto"!==e||(e=i.color),s.set(e);const o=Math.sqrt(.299*s.r**2+.587*s.g**2+.114*s.b**2)<.5?"white":"#111111";if("radio"===t.type&&(r(h,u,p,m,m),d.fillStyle="white",d.strokeStyle=e,d.lineWidth=1,d.fill(),d.stroke(),t.checked&&(r(h+2,u+2,p-4,m-4,m),d.fillStyle=e,d.strokeStyle=o,d.lineWidth=2,d.fill(),d.stroke())),"checkbox"===t.type&&(r(h,u,p,m,2),d.fillStyle=t.checked?e:"white",d.strokeStyle=t.checked?o:e,d.lineWidth=1,d.stroke(),d.fill(),t.checked)){const e=d.textAlign;d.textAlign="center";n({color:o,fontFamily:i.fontFamily,fontSize:m+"px",fontWeight:"bold"},h+p/2,u,"âœ”"),d.textAlign=e}if("range"===t.type){const[i,s,n]=["min","max","value"].map((e=>parseFloat(t[e]))),l=(n-i)/(s-i)*(p-m);r(h,u+m/4,p,m/2,m/4),d.fillStyle=o,d.strokeStyle=e,d.lineWidth=1,d.fill(),d.stroke(),r(h,u+m/4,l+m/2,m/2,m/4),d.fillStyle=e,d.fill(),r(h+l,u,m,m,m/2),d.fillStyle=e,d.fill()}"color"!==t.type&&"text"!==t.type&&"number"!==t.type||(c.add({x:h,y:u,width:p,height:m}),n(i,h+parseInt(i.paddingLeft),u+parseInt(i.paddingTop),t.value),c.remove())}}const f="auto"===i.overflow||"hidden"===i.overflow;f&&c.add({x:h,y:u,width:p,height:m});for(let o=0;o<t.childNodes.length;o++)e(t.childNodes[o],i);f&&c.remove()}(t),h}const n={type:"",data:new THREE.Vector2};AFRAME.registerComponent("html",{schema:{html:{type:"selector"},cursor:{type:"selector"}},init(){this.rerender=this.rerender.bind(this),this.handle=this.handle.bind(this),this.onClick=e=>this.handle("click",e),this.onMouseLeave=e=>this.handle("mouseleave",e),this.onMouseEnter=e=>this.handle("mouseenter",e),this.onMouseUp=e=>this.handle("mouseup",e),this.onMouseDown=e=>this.handle("mousedown",e),this.mouseMoveDetail={detail:{cursorEl:null,intersection:null}}},play(){this.el.addEventListener("click",this.onClick),this.el.addEventListener("mouseleave",this.onMouseLeave),this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("mouseup",this.onMouseUp),this.el.addEventListener("mousedown",this.onMouseDown)},pause(){this.el.removeEventListener("click",this.onClick),this.el.removeEventListener("mouseleave",this.onMouseLeave),this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("mouseup",this.onMouseUp),this.el.removeEventListener("mousedown",this.onMouseDown)},update(){if(this.remove(),!this.data.html)return;const e=new t(this.data.html);this.el.setObject3D("html",e),this.data.html.addEventListener("input",this.rerender),this.data.html.addEventListener("change",this.rerender),this.cursor=this.data.cursor?this.data.cursor.object3D:null},tick(){if(this.activeRaycaster){const e=this.activeRaycaster.components.raycaster.getIntersection(this.el);this.mouseMoveDetail.detail.cursorEl=this.activeRaycaster,this.mouseMoveDetail.detail.intersection=e,this.handle("mousemove",this.mouseMoveDetail)}},handle(e,t){const o=t.detail.intersection,i=t.detail.cursorEl;if("mouseenter"===e&&(this.activeRaycaster=i),"mouseleave"===e&&this.activeRaycaster===i&&(this.activeRaycaster=null),this.cursor&&(this.cursor.visible=!1),o){const t=this.el.getObject3D("html"),i=o.uv;n.type=e,n.data.set(i.x,1-i.y),t.dispatchEvent(n),this.cursor&&(this.cursor.visible=!0,this.cursor.parent.worldToLocal(this.cursor.position.copy(o.point)))}},rerender(){const e=this.el.getObject3D("html");e&&!e.material.map.scheduleUpdate&&(e.material.map.scheduleUpdate=setTimeout((()=>e.material.map.update()),16))},remove(){const e=this.el.getObject3D("html");e&&(this.el.removeObject3D("html"),this.data.html.removeEventListener("input",this.rerender),this.data.html.removeEventListener("change",this.rerender),e.dispose()),this.activeRaycaster=null,this.mouseMoveDetail.detail.cursorEl=null,this.mouseMoveDetail.detail.intersection=null,this.cursor=null}})}(THREE);
//# sourceMappingURL=aframe-html.min.js.map
